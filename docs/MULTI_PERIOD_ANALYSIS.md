# PH√ÇN T√çCH ƒêA CHU K·ª≤ - 8 TH√ÅNG 2025

## üîç T·ªïng Quan

**Test periods:** 8 th√°ng (Jan - Aug 2025)  
**Total bars:** 5,639 hours  
**Market conditions:**
- ‚úÖ UPTREND: 4 periods (Jan, Apr, May, Jul)
- ‚ùå DOWNTREND: 2 periods (Feb, Aug)
- ‚ÜîÔ∏è SIDEWAY: 2 periods (Mar, Jun)

---

## üìä K·∫øt Qu·∫£ T·ªïng H·ª£p

### Win Rate By Trend

| Trend | CONSERVATIVE | OPTIMIZED | AGGRESSIVE |
|-------|--------------|-----------|------------|
| **UPTREND** (4 periods) | 2 wins / 4 (50%) | 0 wins / 4 (0%) | 1 win / 4 (25%) |
| **DOWNTREND** (2 periods) | 0 wins / 2 (0%) | 0 wins / 2 (0%) | 0 wins / 2 (0%) |
| **SIDEWAY** (2 periods) | 0 wins / 2 (0%) | 0 wins / 2 (0%) | 0 wins / 2 (0%) |
| **OVERALL** | **2/8 (25%)** | **0/8 (0%)** | **1/8 (12.5%)** |

### Average Performance

| Config | Avg ROI | Avg Sharpe | Avg MaxDD | Best Month | Worst Month |
|--------|---------|------------|-----------|------------|-------------|
| CONSERVATIVE | **-4.74%** | -8.24 | -16.41% | +25.70% (Jan) | -20.02% (Apr) |
| OPTIMIZED | -16.64% | -12.65 | -23.85% | +1.45% (Mar) | -25.03% (Apr) |
| AGGRESSIVE | -16.66% | -13.70 | -25.54% | +24.95% (May) | -30.04% (Jul) |

---

## ‚ö†Ô∏è V·∫§Nƒê·ªÄ PH√ÅT HI·ªÜN

### 1. **Chi·∫øn L∆∞·ª£c Thua L·ªó Trong Downtrend**

#### Feb 2025 (Downtrend -17.28%)
```
CONSERVATIVE:  -18.87% (hit max drawdown after 28 bars)
OPTIMIZED:     -23.40% (hit max drawdown after 23 bars)
AGGRESSIVE:    -27.59% (hit max drawdown after 23 bars)
```

**Nguy√™n nh√¢n:**
- BTC gi·∫£m t·ª´ $102k ‚Üí $84k (-17.28%)
- Grid **ch·ªâ mua khi gi√° xu·ªëng**, kh√¥ng c√≥ c∆° ch·∫ø SHORT
- Spot holdings b·ªã l·ªó n·∫∑ng do gi√° gi·∫£m li√™n t·ª•c
- Hedge futures kh√¥ng ƒë·ªß m·∫°nh ƒë·ªÉ cover spot losses

#### Aug 2025 (Downtrend -5.74%)
```
CONSERVATIVE:  -19.05% (stopped after 35 bars)
OPTIMIZED:     -16.04% (stopped after 34 bars)
AGGRESSIVE:    -27.84% (stopped after 31 bars)
```

**K·∫øt lu·∫≠n:** Chi·∫øn l∆∞·ª£c **KH√îNG ho·∫°t ƒë·ªông trong downtrend**

---

### 2. **Ch·ªâ Th√†nh C√¥ng Trong 2/8 Th√°ng**

#### ‚úÖ Jan 2025: CONSERVATIVE +25.70%
- Uptrend +11.13%, low volatility 2.81%
- Grid triggers √≠t, gi·ªØ BTC v√† h∆∞·ªüng l·ª£i t·ª´ uptrend
- Max DD ch·ªâ -8.05%

#### ‚úÖ Jul 2025: CONSERVATIVE +7.93%
- Uptrend +9.73%, very low volatility 1.61%
- T∆∞∆°ng t·ª± Jan, grid √≠t trigger, hold BTC tƒÉng gi√°

#### ‚úÖ May 2025: AGGRESSIVE +24.95%
- Uptrend +10.20%, volatility 1.99%
- Aggressive config ho·∫°t ƒë·ªông t·ªët trong low vol uptrend

**Pattern:** Ch·ªâ th·∫Øng khi:
1. Market UPTREND
2. Volatility TH·∫§P (< 2%)
3. √çt rebalance

---

### 3. **Max Drawdown Hit Li√™n T·ª•c**

Trong 8 th√°ng:
- **CONSERVATIVE:** 6/8 th√°ng hit max drawdown (-15% - -20%)
- **OPTIMIZED:** 7/8 th√°ng hit max drawdown (-23% - -25%)
- **AGGRESSIVE:** 7/8 th√°ng hit max drawdown (-27% - -30%)

**L√Ω do:**
- Threshold qu√° th·∫•p (15%, 20%, 25%)
- Chi·∫øn l∆∞·ª£c kh√¥ng c√≥ c∆° ch·∫ø stop-loss s·ªõm
- M·ªôt khi trend ƒë·∫£o chi·ªÅu, l·ªó r·∫•t nhanh

---

### 4. **Grid Kh√¥ng Ho·∫°t ƒê·ªông Nh∆∞ D·ª± Ki·∫øn**

**S·ªë l∆∞·ª£ng trades th·ª±c t·∫ø:**
```
Jan:  1 buy, 1 sell  (expected: 20-30)
Feb:  1 buy, 0 sell  (stopped early)
Mar:  buys only      (stopped early)
...
```

**V·∫•n ƒë·ªÅ:**
- Grid levels qu√° r·ªông ‚Üí √≠t trigger
- Rebalance threshold 15-18% ‚Üí ch·ªâ rebalance khi trend m·∫°nh
- Khi rebalance, market ƒë√£ reverse ‚Üí hit drawdown

---

## üí° PH√ÇN T√çCH S√ÇU

### T·∫°i Sao Th√°ng 1 Th√†nh C√¥ng Nh∆∞ng Th√°ng 4 Th·∫•t B·∫°i?

C·∫£ 2 th√°ng ƒë·ªÅu UPTREND (+11% v√† +14%), nh∆∞ng:

| Metric | Jan (‚úÖ +25.70%) | Apr (‚ùå -20.02%) |
|--------|------------------|------------------|
| Volatility | 2.81% | 2.77% |
| Start price | $94k | $82k |
| End price | $104k | $94k |
| Path | Smooth up | **Crash first then up** |

**Apr 2025 detail:**
- Gi√° start $82k
- **Crash xu·ªëng $74k (-9.7%)** trong 5 ng√†y ƒë·∫ßu
- Sau ƒë√≥ m·ªõi ph·ª•c h·ªìi l√™n $94k

‚Üí Grid mua ·ªü $82k, crash xu·ªëng $74k ‚Üí **hit max drawdown -20%**

**K·∫øt lu·∫≠n:** Chi·∫øn l∆∞·ª£c kh√¥ng ch·ªãu ƒë∆∞·ª£c volatility spike ƒë·∫ßu period

---

### T·∫°i Sao Feb & Aug (Downtrend) L·ªó N·∫∑ng?

Grid strategy **v·ªën dƒ© long-biased**:
- Mua khi gi√° xu·ªëng d∆∞·ªõi EMA
- Sell khi gi√° l√™n tr√™n v√† c√≥ profit
- **Kh√¥ng c√≥ c∆° ch·∫ø SHORT spot**

Trong downtrend:
1. Grid mua BTC ·ªü $102k (Feb start)
2. BTC gi·∫£m xu·ªëng $84k (-17%)
3. Spot holdings l·ªó **-$1,700** (17% * $10k)
4. Hedge futures ch·ªâ c√≥ ~$300-400 profit (3-4% hedge size)
5. **Net loss:** -$1,300+ = -13%+ ROI
6. Add fees ‚Üí total loss -18% to -23%

**Hedge kh√¥ng ƒë·ªß m·∫°nh:**
```python
'hedge_sizes': [0.08, 0.12, 0.15]  # Only 8-15% of capital
```

ƒê·ªÉ hedge ƒë·ªß cho spot losses 17%, c·∫ßn hedge size ‚â• 100% (1:1 hedge).

---

## üéØ GI·∫¢I PH√ÅP

### Option 1: Ch·ªâ Trade Trong Uptrend

Th√™m **trend filter:**
```python
def should_trade(ema_50, ema_200, price):
    # Only trade if uptrend
    if ema_50 > ema_200 and price > ema_200:
        return True
    return False
```

**Expected improvement:**
- Skip Feb, Aug (downtrend) ‚Üí Tr√°nh l·ªó -18% to -27%
- Only trade Jan, Apr, May, Jul (uptrend)
- Win rate: 2/4 = 50% trong uptrend (better than 2/8 = 25% overall)

---

### Option 2: TƒÉng Hedge Trong Downtrend

Dynamic hedge size based on trend:
```python
if ema_50 < ema_200:  # Downtrend
    hedge_sizes = [0.30, 0.50, 0.80]  # 30-80% hedge
else:  # Uptrend
    hedge_sizes = [0.08, 0.12, 0.15]  # 8-15% hedge
```

**Pros:**
- Protect downside in downtrend
- Keep low hedge cost in uptrend

**Cons:**
- High hedge cost ‚Üí reduce profit in sideways
- Complexity

---

### Option 3: D·ª´ng Trading & Hold Cash Trong Downtrend

```python
if ema_50 < ema_200 and price < ema_200:
    # Close all positions
    # Hold cash
    # Wait for uptrend signal
```

**Expected:**
- Feb: Hold cash instead of -18.87% ‚Üí Save +18.87%
- Aug: Hold cash instead of -19.05% ‚Üí Save +19.05%
- Average ROI: -4.74% + 18.96% = **+14.22%**

---

### Option 4: ƒêi·ªÅu Ch·ªânh Max Drawdown Threshold

Current thresholds qu√° h·∫πp:
```python
CONSERVATIVE: -15%
OPTIMIZED:    -20%
AGGRESSIVE:   -25%
```

**Problem:** Hit max DD trong 6-7/8 th√°ng ‚Üí Kh√¥ng ƒë·ªß th·ªùi gian ƒë·ªÉ ph·ª•c h·ªìi

**Suggestion:**
```python
CONSERVATIVE: -25%  (instead of -15%)
OPTIMIZED:    -30%  (instead of -20%)
AGGRESSIVE:   -35%  (instead of -25%)
```

**Trade-off:**
- More room for recovery
- But higher risk

---

## üìà CONFIG ƒê·ªÄ XU·∫§T M·ªöI

### Config A: Uptrend-Only (Safest)

```python
CONFIG_UPTREND_ONLY = {
    'initial_capital': 10_000,
    
    # Trend Filter
    'require_uptrend': True,
    'ema_fast': 50,
    'ema_slow': 200,
    
    # Grid (same as CONSERVATIVE)
    'grid_step': 0.025,
    'grid_take_profit': 0.035,
    'grid_risk_per_order': 0.05,
    
    # Lower hedge in uptrend
    'hedge_atr_threshold': [4.0, 6.0, 8.0],
    'hedge_sizes': [0.05, 0.10, 0.15],
    
    # Risk
    'max_drawdown_threshold': 0.25,
}
```

**Expected:**
- Only trade 4/8 months (uptrends)
- Win 2/4 = 50%
- Avg ROI in uptrends: +3.85% (CONSERVATIVE)
- Skip downtrends ‚Üí Save +18.96%
- **Overall: ~+15-20% / period when trading**

---

### Config B: Dynamic Hedge (Balanced)

```python
CONFIG_DYNAMIC_HEDGE = {
    'initial_capital': 10_000,
    
    # Grid
    'grid_step': 0.025,
    'grid_take_profit': 0.035,
    'grid_risk_per_order': 0.05,
    
    # Dynamic Hedge
    'uptrend_hedge_sizes': [0.05, 0.10, 0.15],
    'downtrend_hedge_sizes': [0.40, 0.60, 0.80],
    
    # Risk
    'max_drawdown_threshold': 0.30,
}
```

**Expected:**
- Trade all periods
- Downtrend losses: -18% ‚Üí -8% (hedged)
- Uptrend profits: +13% ‚Üí +10% (lower due to hedge cost)
- **Overall: +5-8% average**

---

## ‚úÖ K·∫æT LU·∫¨N

### Th·ª±c T·∫ø Ph≈© Ph√†ng

Original strategy (CONSERVATIVE) c√≥:
- **Win rate: 25% (2/8 th√°ng)**
- **Average ROI: -4.74%**
- **Worst loss: -20% trong 1 th√°ng**

Ch·ªâ ho·∫°t ƒë·ªông t·ªët khi:
1. Market UPTREND
2. Volatility < 2%
3. Kh√¥ng c√≥ flash crash

### Khuy·∫øn Ngh·ªã

**Cho Real Trading:**

1. ‚úÖ **D√πng Config UPTREND_ONLY**
   - Only trade khi EMA50 > EMA200
   - Expected: +15-20% ROI trong uptrend periods
   - Avoid: -18 to -27% losses trong downtrend

2. ‚úÖ **TƒÉng Max Drawdown Threshold**
   - T·ª´ -15% ‚Üí -25%
   - Cho ph√©p recovery trong volatile periods

3. ‚úÖ **Add Stop-Loss S·ªõm H∆°n**
   - N·∫øu loss -10% trong 3 ng√†y ‚Üí Stop
   - Tr√°nh loss -20% trong 5 ng√†y nh∆∞ Apr, Feb

4. ‚úÖ **Monitor Trend Daily**
   - Calculate EMA50, EMA200 h√†ng ng√†y
   - Exit positions n·∫øu trend reverse

### Next Steps

1. Implement CONFIG_UPTREND_ONLY
2. Backtest l·∫°i 8 th√°ng v·ªõi trend filter
3. Verify win rate tƒÉng l√™n 50%+
4. Paper trade 1-2 th√°ng tr∆∞·ªõc khi live

---

**T√≥m l·∫°i:** Grid strategy kh√¥ng ph√π h·ª£p v·ªõi ALL market conditions. C·∫ßn **trend filter** ƒë·ªÉ ch·ªâ trade trong uptrend, ho·∫∑c **dynamic hedge** ƒë·ªÉ protect downside.
